---
- hosts: localhost
  gather_facts: false
  collections:
    - infinidat.infinibox
  vars:
    name: iSCSI
    service: ISCSI_SERVICE
  tasks:

    - name: POSITIVE test -> Create {{ service }} network space named {{ name }}
      infini_network_space:
        name: "{{ name }}"
        state: present
        interfaces:
          - 1680
          - 1679
          - 1678
        service: "{{ service }}"
        netmask: 19
        network: 172.31.32.0
        default_gateway: 172.31.63.254
        # rate_limit: 8
        # mtu: 1280
        ips:
          - 172.31.32.145
          - 172.31.32.146
          - 172.31.32.147
          - 172.31.32.148
          - 172.31.32.149
          - 172.31.32.150
        user: "{{ user }}"
        password: "{{ password }}"
        system: "{{ system }}"
      register: create_out

    - name: debug
      ansible.builtin.debug:
        var: create_out

    - name: POSITIVE test -> Stat {{ service }} network space named {{ name }}
      infini_network_space:
        name: "{{ name }}"
        state: stat
        user: "{{ user }}"
        password: "{{ password }}"
        system: "{{ system }}"
