---

- name: get dem debby boiz done up
  hosts:
    - kates
    #- swarm
    #- rancher
    #- keycloak
    #- sentry
  become: true

  tasks:
    - name: upd8 every m8
      apt:
        upgrade: full
        update_cache: yes

    - name: INSTALL good packages
      apt:
        name:
          - vim
          - tmux
          - htop
          - stterm
          - qemu-guest-agent
          - python
          - python-apt
          - python3
          - python3-apt
          - nfs-common
          - nfs4-acl-tools
          - glusterfs-server
          - open-iscsi
          - multipath-tools
          - lsscsi
          - sg3-utils
          - scsitools
        state:
          present

    - name: DELET this
      apt:
        name:
          - nano
        state:
          absent

    - name: Copy /etc/network/interfaces config
      copy:
        src: debinterfaces
        dest: /etc/network/interfaces
        owner: root
        group: root
        mode: '0644'

    - name: Copy /etc/multipath.conf config
      copy:
        src: multipath.conf
        dest: /etc/multipath.conf
        owner: root
        group: root
        mode: '0644'

    - name: Enable and start multipath-tools
      systemd:
       name: multipath-tools
       state: started
       enabled: yes

    - name: Enable and start open-iscsi
      systemd:
       name: open-iscsi
       state: started
       enabled: yes

    #- name: restart networking
    #  systemd:
    #    name: networking
    #    state: restarted
    #    daemon_reload: yes

    - name: rebooty the debooty
      reboot:
        reboot_timeout: 300

...
