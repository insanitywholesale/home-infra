---

- name: get proxie moxie dressed right
  hosts: proxie
  become: true

  tasks:
    - name: remove garbo enterprise repo
      file:
        path: /etc/apt/sources.list.d/pve-enterprise.list
        state: absent

    - name: no-sub squad gang
      copy:
        src: pve-no-sub.list
        dest: /etc/apt/sources.list.d/pve-no-subscription.list
        mode: '0644'
        owner: root
        group: root

    - name: get debbie could image
      get_url:
        url: http://cdimage.debian.org/cdimage/openstack/current-10/debian-10-openstack-amd64.qcow2
        dest: /root/debian-10-openstack-amd64.qcow2
        checksum: sha256:e07b6cd614518b018d95c375d67681d3b079d930b47e4095741b13d4678ea96e
        mode: '0644'
        owner: root
        group: root


    - name: get templ vm scriptoid
      copy:
        src: setup-debian-cloudinit.sh
        dest: /root/setup-debian-template.sh
        mode: '0755'
        owner: root
        group: root

    - name: run templ vm scriptoid
      shell:
        chdir: /root/
        cmd: /root/setup-debian-template.sh
